import os
import csv

# 指定資料夾路徑
folders = ['7_combined_txt_files']  # 這裡替換為兩個資料夾的路徑

# 特定字與輸出名稱對應
keywords_mapping = {
    "SYUL": "南山人壽威美鑽美元利率變動型終身壽險(定期給付)_SYUL",
    "BYUPL7": "南山人壽豐盈保倍美元利率變動型終身壽險(定期給付)_BYUPL7",
    "2BTL": "南山人壽添多利利率變動型增額終身保險(定期給付)_2BTL",
    "BTPL": "南山人壽佳多保利率變動型終身保險(定期給付)_BTPL",
    "BUPL5G": "南山人壽新多福保美元利率變動型終身保險(定期給付)_BUPL5G",
    "TPHI5": "南山人壽樂活洋溢醫療終身保險_TPHI5",
    "2BTE2": "南山人壽年年滿利利率變動型還本終身保險(定期給付)_2BTE2",
    "STL6": "南山人壽享添鑽利率變動型終身保險(定期給付)_STL6",
    "BYUPL8": "南山人壽添保倍美元利率變動型終身壽險(定期給付)_BYUPL8",
    "BYUPL6": "南山人壽豐盈滿山美元利率變動型終身壽險(定期給付)_BYUPL6",
    "EHJIPL": "凱基人壽全民小額終身壽險_EHJIPL",
    "MPL3": "南山人壽新福愛小額終身壽險_MPL3",
    "APMIPL": "凱基人壽十全十美美元利率變動型養老保險(定期給付)_APMIPL",
    "2BTE2": "南山人壽年年滿利利率變動型還本終身保險(定期給付)_2BTE2",
    "APMTPL": "凱基人壽金旺來利率變動型終身壽險(定期給付)_APMTPL",
    "APMLPL": "凱基人壽大基大利美元利率變動型終身壽險(定期給付)_APMLPL",
    "APMEPL": "凱基人壽好基利美元利率變動型終身壽險(定期給付)_APMEPL",
    "APMOPL": "凱基人壽基業長鴻美元利率變動型終身壽險(定期給付)_APMOPL",
    "APMPPL": "凱基人壽龍保倍美元利率變動型終身壽險(定期給付)_APMPPL",
    "APMKPL": "凱基人壽澳氣十足澳幣利率變動型養老保險(定期給付)_APMKPL",
    "APLYPL": "凱基人壽招財進保利率變動型終身壽險(定期給付)_APLYPL",
    "APKTPL": "凱基人壽天天開鑫利率變動型終身保險(定期給付)_APKTPL",
    "APKQTL": "凱基人壽天天有利利率變動型終身壽險(定期給付)_APKQTL",

    "APWHPL": "凱基人壽鑫安利得利率變動型終身壽險(定期給付)_APWHPL",
    "BPJAPL": "凱基人壽美年鑽美元利率變動型終身保險(定期給付)_BPJAPL",
     "BPLTPL": "凱基人壽享利開鑫利率變動型終身保險(定期給付)_BPLTPL",

     "113年5月27日": "全球人壽金美富貴利率變動型美元終身壽險(定額給付)",
     "113年1月29日": "全球人壽金采福旺利率變動型終身壽險(定額給付)",
     "113年7月1日": "全球人壽鑫美富足利率變動型美元增額終身壽險(定額給付)",
     "113年1月29日": "113 年 1月 29 日",
     "112年10月30日": "全球人壽代代緻富利率變動型終身壽險(定額給付)",
     "/ 17": "安達人壽美美優美元利率變動型終身壽險",
     "/ 15": "安達人壽超美得美元利率變動型終身壽險",
      
     "安達人壽美美優": "安達人壽美美優美元利率變動型終身壽險",
     "全球人壽金美福旺利率變動型美元終身壽險(定額給付)": "全球人壽金美福旺利率變動型美元終身壽險(定額給付)",
     "全球人壽豪神六六利率變動型美元終身壽險(定額給付)": "全球人壽豪神六六利率變動型美元終身壽險(定額給付)",
     "全球人壽豪威六六利率變動型終身壽險(定額給付)": "全球人壽豪威六六利率變動型終身壽險(定額給付)",


}

# 特定檔案與特定字強制匹配的清單（無論內容是否包含）
forced_matches = {
    "155.txt": ["全球人壽金美福旺利率變動型美元終身壽險(定額給付)"],  
    "156.txt": ["全球人壽金美福旺利率變動型美元終身壽險(定額給付)"], 
    "16.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],   
    "42.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],     
    "96.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],         
    "118.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],   
    "190.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],     
    "192.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"], 
    "218.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],   
    "238.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],     
    "250.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],         
    "264.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],   
    "267.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],     
    "281.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],
    "288.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],   
    "324.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],     
    "380.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],         
    "389.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],   
    "402.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],     
    "452.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],
    "481.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],   
    "507.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],     
    "523.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],   
    "629.txt": ["全球人壽豪神六六利率變動型美元終身壽險(定額給付)"],      
    "1.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "24.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "112.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "117.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "151.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "161.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "164.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "251.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "323.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "328.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "330.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "369.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],  
    "403.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "490.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "512.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "550.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "560.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],   
    "622.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],  
    "628.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],  
    "637.txt": ["全球人壽豪威六六利率變動型終身壽險(定額給付)"],      
    "638.txt": ["APMOPL"],  
    "56.txt": ["112年10月30日"],   
    "59.txt": ["APKTPL"],          
    
    
}

# 儲存結果的集合，避免重複（檔名,名稱的組合）
results_set = set()

# 遍歷資料夾內的所有 .txt 檔案
for folder_path in folders:
    for filename in os.listdir(folder_path):
        if filename.endswith('.txt'):
            file_path = os.path.join(folder_path, filename)
            
            # 檢查是否在強制匹配清單內
            if filename in forced_matches:
                # 除錯訊息
                #print(f"Processing forced match for file: {filename}")
                # 直接加入強制匹配的特定字與名稱
                for forced_keyword in forced_matches[filename]:
                    if forced_keyword in keywords_mapping:
                        results_set.add((int(filename.split('.')[0]), keywords_mapping[forced_keyword]))
            else:
                # 若不在強制匹配清單內，才檢查文本內容
                with open(file_path, 'r', encoding='utf-8') as file:
                    content = file.read()
                    # 檢查是否包含特定字
                    for keyword, output_name in keywords_mapping.items():
                        if keyword in content:
                            results_set.add((int(filename.split('.')[0]), output_name))

# 把集合轉為排序的清單
results = sorted(list(results_set))
#print("Results before writing to CSV:", results)  # 檢查是否有 1.txt

# 將結果寫入 CSV
csv_file = 'insurance_mapping.csv'
with open(csv_file, 'w', newline='', encoding='utf-8') as csvfile:
    writer = csv.writer(csvfile)
    writer.writerow(['檔名', '名稱'])  # 寫入標頭
    writer.writerows(results)

print(f"結果已輸出到 {csv_file}")